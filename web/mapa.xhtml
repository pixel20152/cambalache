<!DOCTYPE html>  

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">   

    <h:head>  
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>   
    </h:head>   
    <h:body>  

        <h:form>
            <p:commandButton id="btn" type="button" icon="ui-icon-pin-s" value="Show Map" onclick="PF('dlg').show();" />

            <h:inputText id="out01" value="#{draggableMarkersView.marker.latlng.lat}" />
            <h:inputText id="out02" value="#{draggableMarkersView.marker.latlng.lng}" />

            <p:dialog id="gmapDialog" widgetVar="dlg" width="625" height="400" modal="true">
                <p:gmap id="gmap" center="19.3203912,-99.1847294" zoom="14" type="HYBRID"  model="#{draggableMarkersView.draggableModel}" style="width:100%;height:100%">
                    <p:ajax event="markerDrag" listener="#{draggableMarkersView.onMarkerDrag}" update="out01,out02" />
                </p:gmap>
            </p:dialog>
        </h:form>

        <h:form>      
            <p:growl id="growl" showDetail="true" />
            <h:inputText id="out1" value="#{draggableMarkersView.marker.latlng.lat}" />
            <h:inputText id="out2" value="#{draggableMarkersView.marker.latlng.lng}" />

            <p:gmap id="gmap" center="19.3203912,-99.1847294" zoom="14" type="HYBRID"  model="#{draggableMarkersView.draggableModel}" style="width:500px;height:300px">
                <p:ajax event="markerDrag" listener="#{draggableMarkersView.onMarkerDrag}" update="out1,out2" />
            </p:gmap>
        </h:form>
        <script type="text/javascript">
            var currentMarker = null;

            function handlePointClick(event) {
                if (currentMarker === null) {
                    document.getElementById('lat').value = event.latLng.lat();
                    document.getElementById('lng').value = event.latLng.lng();

                    currentMarker = new google.maps.Marker({
                        position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
                    });

                    PF('map').addOverlay(currentMarker);

                    PF('dlg').show();
                }
            }

            function markerAddComplete() {
                var title = document.getElementById('title');
                currentMarker.setTitle(title.value);
                title.value = "";

                currentMarker = null;
                PF('dlg').hide();
            }

            function cancel() {
                PF('dlg').hide();
                currentMarker.setMap(null);
                currentMarker = null;

                return false;
            }
        </script>

    </h:body>
</html>